layui.use(["element","form","jquery","cropper","common"],function(){var c=layui.element(),d=layui.form(),b=layui.layer,e=layui.jquery;common=layui.common;e(document).ready(function(){a()});function a(){var g=e(".img-crop > img");e(g).cropper({aspectRatio:1/1,preview:".img-preview",done:function(){}});var f=e("#inputImage");window.FileReader?f.change(function(){var k,j=new FileReader,h=this.files;h.length&&(k=h[0],/^image\/\w+$/.test(k.type)?(j.readAsDataURL(k),j.onload=function(){f.val(""),g.cropper("reset",!0).cropper("replace",this.result)}):showMessage("请上传图片！"))}):f.addClass("hide"),e("#upload").click(function(){var h=b.msg("头像上传中，请稍侯。。。",{icon:16,time:false});common.ajax(e(this).data("href"),"post","json",{avatar:g.cropper("getDataURL")},function(i){b.close(h);switch(i.code){case"200":common.alertSuccess(i.msg,null);setTimeout(function(){e("#avatar1",window.parent.document).attr("src",g.cropper("getDataURL"));e("#avatar2",window.parent.document).attr("src",g.cropper("getDataURL"))},2000);break;default:common.alertError(i.msg,null);break}});e("#upload").removeAttr("disabled");e(this).text("确认保存")}),e("#zoomIn").click(function(){g.cropper("zoom",0.1)}),e("#zoomOut").click(function(){g.cropper("zoom",-0.1)}),e("#rotateLeft").click(function(){g.cropper("rotate",90)}),e("#rotateRight").click(function(){g.cropper("rotate",-90)}),e("#setDrag").click(function(){g.cropper("setDragMode","crop")})}d.verify({password:function(f){if(e("input[name=password]").val()!==f){return"两次密码不一致！"}}});d.on("submit(formProfile)",function(f){var g=b.msg("数据提交中，请稍等。。。",{icon:16,time:false});common.ajax(e("#formProfile").attr("action"),"post","json",f.field,function(h){b.close(g);switch(h.code){case"200":common.alertSuccess(h.msg,null);setTimeout(function(){e("#nickname",window.parent.document).text(f.field.nickname)},2000);break;default:common.alertError(h.msg,null);break}});return false});d.on("submit(formPassword)",function(f){var g=b.msg("数据提交中，请稍等。。。",{icon:16,time:false});common.ajax(e("#formPassword").attr("action"),"post","json",{password:f.field["confirm-password"]},function(h){b.close(g);switch(h.code){case"200":common.alertSuccess(h.msg,null);setTimeout(function(){e("#formPassword")[0].reset()},2000);break;default:common.alertError(h.msg,null);break}});return false})});